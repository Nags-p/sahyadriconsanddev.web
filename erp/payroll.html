<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll - Sahyadri ERP</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../dashboard.css">
    <link rel="stylesheet" href="erp.css">
</head>
<body>
    <div class="dashboard-layout" id="erp-layout">
        <div class="sidebar" id="erp-sidebar"></div>
        
        <div class="main-content">
            <div id="page-payroll" class="page active">
                <div class="content-box">
                    <div class="analytics-header">
                        <h2>Payroll Processing</h2>
                    </div>

                     <!-- ========================================================== -->
            <!-- === NEW A4 PAYSLIP TEMPLATE (REPLACE OLD ONE) === -->
            <!-- ========================================================== -->
            <div style="position: absolute; left: -9999px; top: auto;">
                <div id="payslip-template" class="a4-sheet">
                    <div class="slip-header">
                        <img src="../images/logo.png" class="slip-logo" alt="Logo">
                        <div class="slip-header-info">
                            <h2>Salary Slip</h2>
                            <p>For the Month of <span id="slip-month-year"></span></p>
                        </div>
                    </div>

                    <div class="slip-section employee-details">
                        <table>
                            <tr>
                                <td><strong>Employee Name:</strong> <span id="slip-employee-name"></span></td>
                                <td><strong>Designation:</strong> <span id="slip-designation"></span></td>
                            </tr>
                            <tr>
                                <td><strong>Employee ID:</strong> <span id="slip-employee-id"></span></td>
                                <td><strong>Date of Joining:</strong> <span id="slip-doj"></span></td>
                            </tr>
                        </table>
                    </div>

                    <div class="slip-section salary-grid">
                        <div class="salary-column">
                            <h4>Earnings</h4>
                            <table>
                                <tr>
                                    <td>Gross Salary</td>
                                    <td class="amount" id="slip-gross"></td>
                                </tr>
                                 <tr class="total-row">
                                    <td><strong>Total Earnings</strong></td>
                                    <td class="amount"><strong id="slip-total-earnings"></strong></td>
                                </tr>
                            </table>
                        </div>
                        <div class="salary-column">
                            <h4>Deductions</h4>
                            <table>
                                <tr>
                                    <td>Professional Tax</td>
                                    <td class="amount">â‚¹0.00</td>
                                </tr>
                                <tr>
                                    <td>Other Deductions</td>
                                    <td class="amount" id="slip-deductions"></td>
                                </tr>
                                <tr class="total-row">
                                    <td><strong>Total Deductions</strong></td>
                                    <td class="amount"><strong id="slip-total-deductions"></strong></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="slip-section summary-details">
                         <table>
                            <tr>
                                <td><strong>Total Days in Month:</strong> <span id="slip-total-days"></span></td>
                                <td><strong>Payable Days:</strong> <span id="slip-payable-days"></span></td>
                            </tr>
                        </table>
                    </div>

                    <div class="slip-net-pay">
                        <p>Net Salary Payable</p>
                        <h3 id="slip-net-salary"></h3>
                        <p class="net-words" id="slip-net-words"></p>
                    </div>

                    <div class="slip-footer">
                        This is a computer-generated salary slip and does not require a signature.
                    </div>
                </div>
            </div>
            <!-- ========================================================== -->

                    <!-- Controls -->
                    <div class="controls-bar" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; align-items: flex-end;">
                        <div class="form-group" style="flex: 1; min-width: 200px;">
                            <label for="payroll-month">Select Payroll Month</label>
                            <input type="month" id="payroll-month">
                        </div>
                        <div class="form-group">
                             <button id="load-payroll-btn" class="btn-primary"><i class="fas fa-cogs"></i> Load Payroll Data</button>
                        </div>
                    </div>

                    <!-- Payroll Table -->
                    <div style="overflow-x: auto;">
                        <table id="payroll-table">
                            <thead>
                                <tr>
                                    <th>Employee Name</th>
                                    <th>Total Days</th>
                                    <th>Payable Days</th>
                                    <th>Gross Salary</th>
                                    <th>Deductions</th>
                                    <th>Net Salary</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="payroll-table-body">
                                <tr><td colspan="7" style="text-align: center; padding: 20px;">Please select a month and click "Load".</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Action Buttons -->
                     <div id="payroll-actions" class="button-group" style="margin-top:25px; display: none;">
                        <button id="revert-payroll-btn" class="btn-danger" style="display: none;"><i class="fas fa-undo"></i> Revert Process</button>
                        <button id="process-payroll-btn" class="btn-success" disabled><i class="fas fa-check-circle"></i> Process Payroll</button>
                        <button id="generate-slips-btn" class="btn-secondary" disabled><i class="fas fa-file-pdf"></i> Generate Slips</button>
                        <button id="export-csv-btn" class="btn-info" disabled><i class="fas fa-file-csv"></i> Export to Bank Sheet</button>
                    </div>
                    <div id="payroll-status" class="status-message"></div>

                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../config.js" defer></script>
    <script src="loader.js" defer></script>
    <!-- ADD THE NEW JS FILE FOR THIS PAGE -->
    <script src="payroll.js" defer></script>
</body>
</html>